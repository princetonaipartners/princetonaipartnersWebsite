<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Loyalty System â€” Cashier Interface Demo</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
  :root {
      --bg-color: #F8F8F6;
      --primary-text-color: #1D1D1F;
      --secondary-text-color: #6E6E73;
      --accent-gradient: linear-gradient(45deg, #0A84FF, #0060CE);
      --accent-color-start: #0A84FF;
      --border-color: #d2d2d7;
      --card-bg-color: #FFFFFF;
      --input-bg: #FFFFFF;
      --font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  * { box-sizing: border-box; }

  html, body {
    margin:0;
    background: var(--bg-color);
    color: var(--primary-text-color);
    font-family: var(--font-family);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
  }

  body {
      padding-bottom: env(safe-area-inset-bottom, 20px);
      min-height: 100vh;
  }

  #particles-js {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: -1;
  }

  /* DEMO Watermark */
  .demo-watermark {
    position: fixed;
    top: 12px;
    right: 12px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--secondary-text-color);
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .wrap {
    max-width: 940px;
    margin: 0 auto;
    padding: 16px;
  }

  .live-clock {
    text-align: center;
    color: var(--secondary-text-color);
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 12px;
    padding: 0 8px;
  }

  .card{
    background: var(--card-bg-color);
    border-radius: 20px;
    padding: 20px;
    position: relative;
    border: 1px solid var(--border-color);
    margin-bottom: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,.06);
  }

  .card.screen {
    transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
  }

  .card.screen.hidden {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    position: absolute;
    width: calc(100% - 32px);
    left: 16px;
  }

  h1 {
    margin:0 0 4px;
    font-weight:800;
    font-size: 24px;
    letter-spacing:-.5px;
    color: var(--accent-color-start);
    line-height: 1.2;
  }

  h2{
    margin:0 0 6px;
    font-weight:700;
    font-size: 20px;
    line-height: 1.2;
  }

  .sub{
    color: var(--secondary-text-color);
    margin-bottom:20px;
    font-size: 14px;
    line-height: 1.4;
  }

  .grid{
    display:flex;
    flex-direction: column;
    gap:16px;
  }

  .field{
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  label{
    font-weight:600;
    font-size: 14px;
    color: var(--primary-text-color);
  }

  input[type="tel"],
  input[type="number"],
  input[type="text"]{
    background:var(--input-bg);
    color: var(--primary-text-color);
    border:1px solid var(--border-color);
    border-radius:12px;
    padding:14px;
    font-size:16px;
    outline:none;
    transition: all 0.2s ease-in-out;
    -webkit-appearance: none;
  }

  input:focus{
    box-shadow:0 0 0 3px rgba(10, 132, 255, 0.2);
    border-color: var(--accent-color-start);
  }

  .hint{
    color:var(--secondary-text-color);
    font-size:13px;
    line-height: 1.3;
  }

  .tiles{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }

  .tile{
    padding:10px 14px;
    border:1px solid var(--border-color);
    border-radius:12px;
    cursor:pointer;
    user-select:none;
    background: #f0f0ed;
    color: var(--primary-text-color);
    font-weight:600;
    font-size: 14px;
    transition: all 0.2s ease-in-out;
    -webkit-tap-highlight-color: transparent;
  }

  .tile:active{
    transform: scale(0.98);
  }

  .tile:hover{
    background: #e9e9e7;
    border-color: #c0c0c0;
  }

  .tile.sel{
    border-color: var(--accent-color-start);
    background: #e6f3ff;
    color: #0052cc;
  }

  .row{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .actions{
    margin-top:20px;
    display:flex;
    flex-direction: column;
    gap:12px;
  }

  button{
    padding:14px 20px;
    border:none;
    border-radius:12px;
    font-weight:600;
    font-size:16px;
    cursor:pointer;
    transition: all 0.2s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    -webkit-tap-highlight-color: transparent;
  }

  button:active {
    transform: scale(0.98);
  }

  .primary{
    background: var(--accent-gradient);
    color: #fff;
    box-shadow: 0 4px 15px rgba(0, 113, 227, 0.2);
  }

  .primary:hover{
    transform: scale(1.02);
  }

  .ghost{
    background: #e9e9e7;
    color: var(--primary-text-color);
    border: 1px solid var(--border-color);
  }

  .ghost:hover{
    background: #dcdcdc;
  }

  button[disabled]{
    opacity:.5;
    cursor:not-allowed;
    filter: grayscale(50%);
    transform: none;
  }

  .banner{
    display:none;
    margin-bottom:16px;
    padding:12px 14px;
    border-radius:12px;
    font-weight:600;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    line-height: 1.3;
  }

  .banner .icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .ok{background:#e6f4ea; color:#1e4620; border:1px solid #a3d9b3;}
  .warn{background:#fff8e6; color:#66460d; border:1px solid #ffdab3;}
  .err{background:#fbeae5; color:#8a260c; border:1px solid #f5b8a5;}

  .kpi{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin:8px 0 2px;
  }

  .chip{
    padding:6px 10px;
    border-radius:10px;
    background: #e9e9e7;
    border:1px solid var(--border-color);
    color: var(--primary-text-color);
    font-weight:600;
    font-size: 13px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }

  .chip .icon {
    width: 14px;
    height: 14px;
    opacity: 0.7;
  }

  .chip.badge{
    background:#e6f4ea;
    border-color:#a3d9b3;
    color:#1e4620;
  }

  .summary{
    background: #f9f9f7;
    border:1px solid var(--border-color);
    border-radius:12px;
    padding:14px;
  }

  .summary .row {
    padding: 4px 0;
  }

  .muted{
    color: var(--secondary-text-color);
    font-size: 14px;
  }

  .big{
    font-size:18px;
    font-weight:700;
  }

  .right{
    margin-left:auto;
  }

  .summary .right.updated {
    animation: highlight 0.5s ease-out;
  }

  @keyframes highlight {
    0%, 100% { color: var(--primary-text-color); transform: scale(1); }
    50% { color: var(--accent-color-start); transform: scale(1.08); }
  }

  hr{
    border:none;
    border-top:1px solid var(--border-color);
    margin:10px 0;
  }

  .loading[hidden]{display:none !important;}

  .loading{
    position:absolute;
    inset:0;
    background:rgba(248, 248, 246, 0.85);
    backdrop-filter:blur(2px);
    border-radius:20px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    z-index:5;
    font-size: 16px;
    font-weight: 500;
  }

  .spinner{
    width:24px;
    height:24px;
    border-radius:50%;
    border:4px solid rgba(10, 132, 255, 0.2);
    border-top-color: var(--accent-color-start);
    animation:spin .9s linear infinite;
  }

  @keyframes spin{to{transform:rotate(360deg)}}

  .styled-checkbox-wrap {
    position: relative;
    display: flex;
    align-items: flex-start;
    cursor: pointer;
    user-select: none;
    gap: 10px;
    padding: 4px 0;
    -webkit-tap-highlight-color: transparent;
  }

  .styled-checkbox-wrap input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }

  .checkmark {
    height: 22px;
    width: 22px;
    background-color: var(--input-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    transition: all 0.2s ease;
    display: inline-block;
    flex-shrink: 0;
  }

  .styled-checkbox-wrap:active .checkmark {
    transform: scale(0.95);
  }

  .styled-checkbox-wrap:hover input ~ .checkmark {
    border-color: #a0a0a0;
  }

  .styled-checkbox-wrap input:checked ~ .checkmark {
    background-color: var(--accent-color-start);
    border-color: var(--accent-color-start);
  }

  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
    left: 7px;
    top: 3px;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
  }

  .styled-checkbox-wrap input:checked ~ .checkmark:after {
    display: block;
  }

  .styled-checkbox-wrap[data-disabled="true"] {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .styled-checkbox-wrap span {
    font-size: 14px;
    line-height: 1.3;
    padding-top: 2px;
  }

  /* Accordion Styles */
  .accordion-card {
    padding: 20px;
  }

  .accordion-toggle {
    background: none;
    border: none;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 0;
    margin-bottom: 12px;
    -webkit-tap-highlight-color: transparent;
  }

  .accordion-toggle h2 {
    font-size: 16px;
    margin: 0;
    color: var(--primary-text-color);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .accordion-toggle .icon {
    font-size: 14px;
    transition: transform 0.3s ease-in-out;
  }

  .accordion-toggle.active .icon {
    transform: rotate(180deg);
  }

  .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease-in-out;
    padding: 0;
  }

  .accordion-content h3 {
    font-size: 15px;
    margin-top: 16px;
    margin-bottom: 8px;
    color: var(--primary-text-color);
  }

  .accordion-content p,
  .accordion-content li {
    color: var(--secondary-text-color);
    margin-bottom: 8px;
    font-size: 14px;
    line-height: 1.4;
  }

  .accordion-content ol,
  .accordion-content ul {
    padding-left: 20px;
  }

  .accordion-content strong {
    color: var(--primary-text-color);
    font-weight: 600;
  }

  /* Tablet and Desktop adjustments */
  @media (min-width: 640px) {
    .wrap {
      padding: 24px;
    }

    .card {
      padding: 24px;
      border-radius: 24px;
      margin-bottom: 24px;
    }

    h1 { font-size: 28px; }
    h2 { font-size: 24px; }
    .sub { font-size: 16px; margin-bottom: 24px; }

    .grid.two {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
    }

    .actions {
      flex-direction: row;
    }

    button {
      width: auto;
      padding: 14px 24px;
    }

    .live-clock {
      text-align: right;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .accordion-toggle h2 {
      font-size: 18px;
    }

    .field {
      margin-bottom: 0;
    }
  }

  @media (min-width: 768px) {
    .wrap {
      padding: 32px 18px;
    }

    .summary .row {
      padding: 6px 0;
    }

    .big {
      font-size: 22px;
    }

    .muted {
      font-size: 15px;
    }
  }

  /* iOS-specific fixes */
  @supports (-webkit-touch-callout: none) {
    input[type="tel"],
    input[type="number"],
    input[type="text"] {
      font-size: 16px !important; /* Prevents zoom on iOS */
    }
  }
</style>
</head>
<body>
<div class="demo-watermark">ðŸŽ­ DEMO MODE</div>
<div id="particles-js"></div>
<div class="wrap">
  <!-- ICONS -->
  <svg width="0" height="0" style="display:none">
    <symbol id="icon-ok" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></symbol>
    <symbol id="icon-warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></symbol>
    <symbol id="icon-err" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></symbol>
    <symbol id="icon-phone" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></symbol>
    <symbol id="icon-points" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.38 3.49-2.7-2.7a1 1 0 0 0-1.4 0l-6 6a1 1 0 0 0 0 1.4l2.7 2.7c.4.4 1 .4 1.4 0L12.38 5a1 1 0 0 0 0-1.51Z"/><path d="m11.66 7.22-8.43 8.43a1 1 0 0 0 0 1.4l2.7 2.7a1 1 0 0 0 1.4 0l8.43-8.43c.4-.4.4-1 0-1.4L13.06 7.22c-.4-.4-1-.4-1.4 0Z"/><path d="m18 12.5-5-5"/><path d="m12.5 18-5-5"/><circle cx="7.5" cy="16.5" r=".5" fill="currentColor"/><circle cx="16.5" cy="7.5" r=".5" fill="currentColor"/></symbol>
    <symbol id="icon-visits" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m9 16 2 2 4-4"/></symbol>
  </svg>

  <div class="header-info">
      <div id="liveClock" class="live-clock"></div>
  </div>

  <div class="screens-container" style="position: relative;">
    <!-- LOOKUP CARD -->
    <div class="card screen" id="lookupCard" aria-live="polite">
      <div class="loading" id="loadingA" hidden>
        <div class="spinner" aria-hidden="true"></div><div>Workingâ€¦</div>
      </div>
      <h1>Loyalty System â€” Cashier Interface</h1>
      <div class="sub">Lookup customer, log purchase, apply rewards.</div>

      <div id="bannerA" class="banner"></div>

      <div class="grid two">
        <div class="field">
          <label for="phone">Customer phone *</label>
          <input id="phone" type="tel" inputmode="tel" placeholder="(609) 009-1216" autocomplete="tel" />
        </div>
        <div class="field" style="justify-content: flex-end;">
          <button class="primary" id="btnLookup">Lookup / Start Visit</button>
        </div>
      </div>
    </div>

    <!-- LOG CARD -->
    <div class="card screen hidden" id="logCard" style="display:none" aria-live="polite">
      <div class="loading" id="loadingB" hidden><div class="spinner"></div><div>Finalizingâ€¦</div></div>
      <div id="bannerB" class="banner"></div>

      <div>
          <h2 id="custName">Customer</h2>
          <div class="kpi">
            <span class="chip" id="chipPhone"><svg class="icon"><use href="#icon-phone" /></svg>Phone</span>
            <span class="chip" id="chipPoints"><svg class="icon"><use href="#icon-points" /></svg>Points: 0</span>
            <span class="chip" id="chipVisits"><svg class="icon"><use href="#icon-visits" /></svg>Visits: 0</span>
            <span class="chip" id="chipNext">Next reward in â€”</span>
            <span class="chip badge" id="chipEligible" style="display:none">Eligible: Free drink</span>
          </div>
      </div>

      <div class="summary" style="margin-top: 20px;">
        <div class="row"><div>Subtotal</div><div class="right big" id="sumSubtotal">$0.00</div></div>
        <div class="row"><div class="muted">Reward</div><div class="right" id="sumReward">â€”</div></div>
        <div class="row"><div class="muted">Review bonus</div><div class="right" id="sumReview">â€”</div></div>
        <div class="row"><div class="muted">Points discount</div><div class="right" id="sumPts">$0.00</div></div>
        <hr>
        <div class="row"><div class="big">Net to charge</div><div class="right big" id="sumNet">$0.00</div></div>
      </div>

      <div class="field" style="margin-top: 20px;">
        <label for="orderTotal">Order total ($) *</label>
        <input id="orderTotal" type="number" min="0" step="0.01" placeholder="0.00" />
        <div class="hint" id="pointsHint">Points this visit: 0</div>
      </div>

      <div class="field" style="gap: 12px; margin-top: 16px;">
        <label class="styled-checkbox-wrap" id="reviewWrap">
            <input type="checkbox" id="reviewVerified">
            <span class="checkmark"></span>
            <span>Review verified in-store (-$5 bonus)</span>
        </label>
        <label class="styled-checkbox-wrap" id="applyWrap">
            <input type="checkbox" id="applyReward" disabled>
            <span class="checkmark"></span>
            <span>Apply free Coffee/20oz drink now</span>
        </label>
      </div>

      <div class="grid two" style="margin-top: 16px;">
        <div class="field">
          <label for="redeemPts">Redeem points</label>
          <input id="redeemPts" type="number" min="0" step="1" placeholder="0" />
          <div class="hint" id="redeemHint">Available: 0 Â· $0.00 value (100 pts = $5)</div>
        </div>
        <div class="field" style="justify-content: flex-end;">
          <button class="ghost" id="btnMaxRedeem" type="button">Redeem Max</button>
        </div>
      </div>

      <div class="field" style="margin-top:16px">
        <label>Categories in this order</label>
        <div class="tiles" id="catTiles"></div>
        <div class="hint">Tap all that apply.</div>
      </div>

      <div class="actions">
        <button class="primary" id="btnFinalize">Finalize visit</button>
        <button class="ghost" id="btnBack">Start next customer</button>
      </div>
    </div>

    <!-- CONFIRM CARD -->
    <div class="card screen hidden" id="doneCard" style="display:none" aria-live="polite">
      <div class="banner ok" style="display:flex" id="doneMsg">
        <svg class="icon"><use href="#icon-ok" /></svg>
        <span>Visit logged.</span>
      </div>
      <div class="summary">
        <div class="row"><div>Subtotal</div><div class="right" id="doneSubtotal">$0.00</div></div>
        <div class="row"><div>Reward</div><div class="right" id="doneReward">â€”</div></div>
        <div class="row"><div>Review bonus</div><div class="right" id="doneReview">â€”</div></div>
        <div class="row"><div>Points discount</div><div class="right" id="donePts">$0.00</div></div>
        <hr>
        <div class="row"><div class="big">Net</div><div class="right big" id="doneNet">$0.00</div></div>
      </div>
      <div class="actions"><button class="primary" id="btnReset">Start next customer</button></div>
    </div>
  </div>

  <div class="card accordion-card">
    <button class="accordion-toggle" id="sopToggle">
        <h2><i class="fas fa-book-open"></i> Cashier Quick Guide (SOP)</h2>
        <i class="fas fa-chevron-down icon"></i>
    </button>
    <div class="accordion-content" id="sopContent">
        <h3>Procedure 1: First-Time Customer Experience</h3>
        <ol>
            <li><strong>Initial Lookup:</strong> Greet the customer and ask for their 10-digit phone number to see if they are in the system.</li>
            <li><strong>New Member Signup:</strong> If the app displays a "Customer not enrolled" message, inform the customer and point them to the QR code to sign up.</li>
            <li><strong>Complete Their First Transaction:</strong> After they've signed up, enter their phone number again to find their new account and proceed.</li>
        </ol>

        <h3>Procedure 2: Returning Customer Experience</h3>
        <ol>
            <li><strong>Member Lookup:</strong> Enter the customer's 10-digit phone number to load their profile.</li>
            <li><strong>Enter Order and Apply Rewards:</strong> Input the pre-tax total. Ask if they want to redeem points and check for the review bonus if applicable.</li>
            <li><strong>Finalize the Visit:</strong> Confirm the "Net to charge" with the customer and press "Finalize visit".</li>
        </ol>

        <h3>Points System Rules & Details</h3>
        <ul>
            <li><strong>Earning:</strong> 1 point for every $1 spent on pre-tax totals.</li>
            <li><strong>Redeeming:</strong> 100 points = $5.00 discount.</li>
            <li>Points have no cash value.</li>
        </ul>

        <h3>Frequently Asked Questions (FAQ)</h3>
        <p><strong>Customer doesn't know if they are a member?</strong> Always use the lookup tool first.</p>
        <p><strong>"Finalize visit" button is disabled?</strong> The customer has already checked in today.</p>
        <p><strong>Do points expire?</strong> No, points do not expire.</p>
         <p><strong>Customer wants to update their info?</strong> They need to sign up again or contact support.</p>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
/* ===================== DEMO MODE - NO API CALLS ===================== */
// This is a SAFE DEMO version with hardcoded mock data
// NO webhooks, NO API keys, NO real backend calls
/* ==================================================================== */

const CATEGORIES = ['Grocery','Convenience','Coffee','Deli/food','Krispy Chicken','Other'];
const REWARD_CYCLE = 5;
const DOLLARS_PER_POINT = 0.05; // 100 points = $5

const $ = q => document.querySelector(q);
const money = v => (Number.isFinite(+v) ? (+v).toLocaleString(undefined,{style:'currency',currency:'USD'}) : '$0.00');
const clampValue  = (v,min,max)=> Math.min(max, Math.max(min, v));
const clamp0 = v => Math.max(0, v||0);
const digits10 = v => {
  const d = String(v||'').replace(/\D/g,'');
  return d.length >= 10 ? d.slice(-10) : null;
};

// Generate mock customer data based on phone number
function generateMockCustomer(phone) {
  // Use phone as seed for consistent random data
  const seed = parseInt(phone.slice(-4)) || 1234;

  // Random names pool
  const firstNames = ['Alex', 'Jordan', 'Casey', 'Morgan', 'Taylor', 'Avery', 'Riley', 'Sam', 'Blake', 'Jamie'];
  const lastInitials = ['M', 'T', 'R', 'S', 'K', 'L', 'W', 'B', 'C', 'D'];

  const firstName = firstNames[seed % firstNames.length];
  const lastInitial = lastInitials[Math.floor(seed / 100) % lastInitials.length];

  // Generate realistic data
  const points = 15 + (seed % 200); // 15-214 points
  const visits = 1 + (seed % 20); // 1-20 visits
  const visitsToReward = 5 - (visits % 5); // Next reward in 1-5 visits

  return {
    hasAccount: true,
    customerName: `${firstName} ${lastInitial}.`,
    phone: phone,
    points: points,
    totalVisits: visits,
    visitsToNextReward: visitsToReward === 5 ? 5 : visitsToReward,
    reviewBonusAvailable: (seed % 3) !== 0, // 66% chance of having review bonus
    smsOptin: true,
    alreadyToday: false,
    willUnlockOnFinalize: visitsToReward === 1
  };
}

let state = {
  visitId: null,
  phone10: null,
  customer: null,
  eligibleNow: false,
  alreadyToday: false,
  smsOptin: false,
  points: 0,
  reviewEligible: false,
  redeemPts: 0,
};

function setBanner(elId, kind, text){
  const el = $(elId);
  const icons = {'ok': '#icon-ok', 'warn': '#icon-warn', 'err': '#icon-err'};
  const iconHtml = kind && icons[kind] ? `<svg class="icon"><use href="${icons[kind]}" /></svg>` : '';
  el.className = `banner ${kind}`;
  el.innerHTML = text ? `${iconHtml}<span>${text}</span>` : '';
  el.style.display = text ? 'flex' : 'none';
}
function setLoading(id, on){ $(id).hidden = !on; }

function buildTiles(){
  const box = $('#catTiles'); box.innerHTML = '';
  CATEGORIES.forEach(name=>{
    const div = document.createElement('div');
    div.className = 'tile'; div.textContent = name;
    div.addEventListener('click', ()=>{ div.classList.toggle('sel'); recompute(); });
    box.appendChild(div);
  });
}
function selectedCats(){
  return [...document.querySelectorAll('#catTiles .tile.sel')].map(el=>el.textContent);
}

function maxRedeemPtsGivenSubtotal(subtotal, reviewUsed){
  const maxDollarsFromPts = clamp0(subtotal - (reviewUsed ? 5 : 0));
  return Math.floor(maxDollarsFromPts / DOLLARS_PER_POINT);
}

function flashUpdate(el) {
    el.classList.add('updated');
    el.addEventListener('animationend', () => {
        el.classList.remove('updated');
    }, { once: true });
}

function recompute(){
  const subtotal = Number($('#orderTotal').value || 0);
  const reviewUsed = $('#reviewVerified').checked ? 5 : 0;

  const maxPtsBySubtotal = maxRedeemPtsGivenSubtotal(subtotal, !!reviewUsed);
  const desiredPts = Number($('#redeemPts').value || 0);
  const cap = Math.min(state.points, maxPtsBySubtotal);
  state.redeemPts = clampValue(desiredPts, 0, cap);
  if (desiredPts !== state.redeemPts) $('#redeemPts').value = state.redeemPts;

  const ptsDollars = state.redeemPts * DOLLARS_PER_POINT;

  const apply = $('#applyReward').checked && state.eligibleNow ? 'FREE Coffee or 20 oz Drink' : '';
  const rewardDiscount = 0;
  const net = clamp0(subtotal - reviewUsed - rewardDiscount - ptsDollars);

  $('#pointsHint').textContent = `Points this visit: ${Math.max(0, Math.floor(subtotal))}`;

  if ($('#sumSubtotal').textContent !== money(subtotal)) {
    $('#sumSubtotal').textContent = money(subtotal);
    flashUpdate($('#sumSubtotal'));
  }
  if ($('#sumReward').textContent !== (apply || 'â€”')) {
    $('#sumReward').textContent = apply || 'â€”';
    flashUpdate($('#sumReward'));
  }
  if ($('#sumReview').textContent !== (reviewUsed ? ('-$'+reviewUsed.toFixed(2)) : 'â€”')) {
    $('#sumReview').textContent = reviewUsed ? ('-$'+reviewUsed.toFixed(2)) : 'â€”';
    flashUpdate($('#sumReview'));
  }
  if ($('#sumPts').textContent !== (ptsDollars ? ('-'+money(ptsDollars)) : '$0.00')) {
    $('#sumPts').textContent = ptsDollars ? ('-'+money(ptsDollars)) : '$0.00';
    flashUpdate($('#sumPts'));
  }
  if ($('#sumNet').textContent !== money(net)) {
    $('#sumNet').textContent = money(net);
    flashUpdate($('#sumNet'));
  }

  const remaining = state.points - state.redeemPts;
  $('#redeemHint').textContent = `Available: ${state.points} Â· Using ${state.redeemPts} (left ${remaining}) Â· ${money(state.redeemPts*DOLLARS_PER_POINT)} value (100 pts = $5)`;

  $('#applyWrap').dataset.disabled = $('#applyReward').disabled;
  $('#reviewWrap').dataset.disabled = $('#reviewVerified').disabled;
}

const ALL_SCREENS = ['lookupCard', 'logCard', 'doneCard'];
function showScreen(screenId) {
    ALL_SCREENS.forEach(id => {
        const el = $(`#${id}`);
        if (id === screenId) {
            el.style.display = 'block';
            requestAnimationFrame(() => { el.classList.remove('hidden'); });
        } else {
            el.classList.add('hidden');
            el.addEventListener('transitionend', () => {
                if (el.classList.contains('hidden')) {
                    el.style.display = 'none';
                }
            }, { once: true });
        }
    });
}

function resetAll(){
  state = { visitId:null, phone10:null, customer:null, eligibleNow:false, alreadyToday:false, smsOptin:false, points:0, reviewEligible:false, redeemPts:0 };
  $('#phone').value='';
  setBanner('#bannerA','',''); setBanner('#bannerB','','');
  $('#orderTotal').value='';
  $('#reviewVerified').checked=false;
  $('#applyReward').checked=false;
  $('#applyReward').disabled=true;
  $('#redeemPts').value='0';
  [...document.querySelectorAll('#catTiles .tile')].forEach(el=>el.classList.remove('sel'));
  recompute();
  showScreen('lookupCard');
}

function updateClock() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: '2-digit' };
    $('#liveClock').textContent = now.toLocaleDateString('en-US', options);
}

document.addEventListener('DOMContentLoaded', () => {
    buildTiles();
    resetAll();
    updateClock();
    setInterval(updateClock, 1000);

    // Accordion Toggles
    document.querySelectorAll('.accordion-toggle').forEach(toggle => {
        toggle.addEventListener('click', () => {
            toggle.classList.toggle('active');
            const content = toggle.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    });

    // Particles JS
    particlesJS('particles-js', {
        "particles": {
            "number": { "value": 60, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#0A84FF" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.4, "random": true },
            "size": { "value": 3, "random": true },
            "line_linked": { "enable": false },
            "move": { "enable": true, "speed": 1, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false }
        },
        "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } },
        "retina_detect": true
    });
});

/* ---------- MOCK Lookup (No API Call) ---------- */
$('#btnLookup').addEventListener('click', async ()=>{
  setBanner('#bannerA','','');
  const phone10 = digits10($('#phone').value);
  if (!phone10){ setBanner('#bannerA','warn','Enter a valid phone number.'); return; }

  setLoading('#loadingA', true);

  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 800));

  // ALWAYS generate a mock customer for ANY phone number entered
  const res = generateMockCustomer(phone10);

    state.phone10        = phone10;
    state.customer       = res;
    state.alreadyToday   = res.alreadyToday;
    state.smsOptin       = res.smsOptin;
    state.points         = res.points;
    state.reviewEligible = res.reviewBonusAvailable;
    state.redeemPts      = 0;
    state.eligibleNow = false;
    $('#applyReward').checked = false;
    $('#applyReward').disabled = true;

    const name = res.customerName;
    $('#custName').textContent = name;
    $('#chipPhone').innerHTML = `<svg class="icon"><use href="#icon-phone" /></svg> (${phone10.slice(0,3)}) ${phone10.slice(3,6)}-${phone10.slice(6)}`;
    $('#chipPoints').innerHTML = `<svg class="icon"><use href="#icon-points" /></svg> Points: ${state.points}`;
    $('#chipVisits').innerHTML = `<svg class="icon"><use href="#icon-visits" /></svg> Visits: ${res.totalVisits}`;
    const vtn = res.visitsToNextReward;
    $('#chipNext').textContent = `Next reward in ${vtn} visit(s)`;

    const badge = $('#chipEligible');
    if (res.willUnlockOnFinalize) {
      badge.style.display = 'inline-flex';
      badge.textContent = 'Unlocks on finalize';
    } else { badge.style.display = 'none'; }

    $('#reviewVerified').disabled = !state.reviewEligible;
    $('#reviewVerified').checked  = false;
    setBanner('#bannerB','ok', `Welcome back, ${name}!`);

    $('#redeemPts').value = '0';
    $('#btnFinalize').disabled = false;

    showScreen('logCard');
    recompute();
    setTimeout(() => $('#orderTotal').focus(), 400);

  setLoading('#loadingA', false);
});

/* ---------- Live recompute on changes ---------- */
$('#orderTotal').addEventListener('input', recompute);
$('#reviewVerified').addEventListener('change', recompute);
$('#applyReward').addEventListener('change', recompute);
$('#redeemPts').addEventListener('input', recompute);

function animateCount(el, start, end, duration) {
    if (start === end) { recompute(); return; }
    let startTime = null;
    const animation = currentTime => {
        if (!startTime) startTime = currentTime;
        const progress = Math.min((currentTime - startTime) / duration, 1);
        el.value = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
            requestAnimationFrame(animation);
        } else {
            el.value = end;
            recompute();
        }
    };
    requestAnimationFrame(animation);
}

$('#btnMaxRedeem').addEventListener('click', ()=>{
  const subtotal = Number($('#orderTotal').value || 0);
  const maxBySubtotal = maxRedeemPtsGivenSubtotal(subtotal, $('#reviewVerified').checked);
  const cap = Math.min(state.points, maxBySubtotal);
  const startVal = Number($('#redeemPts').value) || 0;
  animateCount($('#redeemPts'), startVal, cap, 300);
});

/* ---------- MOCK Finalize (No API Call) ---------- */
$('#btnFinalize').addEventListener('click', async ()=>{
  const phone10 = state.phone10;
  const subtotal = Number($('#orderTotal').value || 0);
  if (!phone10){ setBanner('#bannerB','warn','Missing phone.'); return; }
  if (!(subtotal >= 0)){ setBanner('#bannerB','warn','Enter a valid order total.'); return; }

  setLoading('#loadingB', true);

  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 1000));

  // MOCK SUCCESS
  const reviewBonus = $('#reviewVerified').checked ? 5 : 0;
  const usedPtsDollars = state.redeemPts * DOLLARS_PER_POINT;
  const netCharge = Math.max(0, subtotal - reviewBonus - usedPtsDollars);

  $('#doneSubtotal').textContent = money(subtotal);
  $('#doneReward').textContent   = 'â€”';
  $('#doneReview').textContent   = reviewBonus ? '-$'+reviewBonus.toFixed(2) : 'â€”';
  $('#donePts').textContent      = usedPtsDollars ? ('-'+money(usedPtsDollars)) : '$0.00';
  $('#doneNet').textContent      = money(netCharge);
  $('#doneMsg').innerHTML = `<svg class="icon"><use href="#icon-ok" /></svg><span>Demo visit logged successfully!</span>`;

  showScreen('doneCard');
  setLoading('#loadingB', false);
});

/* ---------- Back / Reset ---------- */
$('#btnBack').addEventListener('click', resetAll);
$('#btnReset').addEventListener('click', resetAll);

</script>
</body>
</html>
