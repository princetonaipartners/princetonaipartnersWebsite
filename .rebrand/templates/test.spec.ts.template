import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test.describe('ComponentName', () => {
  test.beforeEach(async ({ page }) => {
    // Navigate to page with component
    await page.goto('/test-page');
  });

  test('should render correctly', async ({ page }) => {
    // Find component
    const component = page.getByTestId('component-name');

    // Verify it's visible
    await expect(component).toBeVisible();

    // Verify content
    await expect(component).toContainText('Expected text');
  });

  test('should handle user interactions', async ({ page }) => {
    // Find interactive element
    const button = page.getByRole('button', { name: /click me/i });

    // Verify initial state
    await expect(button).toBeEnabled();

    // Click button
    await button.click();

    // Verify result
    await expect(page.getByText(/success/i)).toBeVisible();
  });

  test('should be keyboard accessible', async ({ page }) => {
    // Tab to first interactive element
    await page.keyboard.press('Tab');

    // Verify focus
    const focused = page.locator(':focus');
    await expect(focused).toHaveRole('button');

    // Activate with keyboard
    await page.keyboard.press('Enter');

    // Verify action worked
    await expect(page.getByText(/success/i)).toBeVisible();
  });

  test('should not have accessibility violations', async ({ page }) => {
    // Run axe accessibility audit
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa'])
      .analyze();

    // Expect no violations
    expect(accessibilityScanResults.violations).toEqual([]);
  });

  test('should be mobile responsive', async ({ page }) => {
    // Set mobile viewport
    await page.setViewportSize({ width: 375, height: 667 });

    // Verify component adapts
    const component = page.getByTestId('component-name');
    await expect(component).toBeVisible();

    // Verify mobile-specific behavior
    const mobileMenu = page.getByRole('button', { name: /menu/i });
    await expect(mobileMenu).toBeVisible();
  });

  test('should match visual snapshot', async ({ page }) => {
    // Wait for animations to complete
    await page.waitForTimeout(500);

    // Take screenshot
    const component = page.getByTestId('component-name');
    await expect(component).toHaveScreenshot('component-name.png', {
      maxDiffPixels: 100, // Allow small differences
    });
  });

  test('should handle edge cases', async ({ page }) => {
    // Test with empty state
    await page.goto('/test-page?empty=true');
    await expect(page.getByText(/no items/i)).toBeVisible();

    // Test with large dataset
    await page.goto('/test-page?items=100');
    const items = page.getByTestId('list-item');
    await expect(items).toHaveCount(100);
  });

  test('should handle errors gracefully', async ({ page }) => {
    // Trigger error state
    await page.route('**/api/endpoint', (route) => {
      route.fulfill({ status: 500 });
    });

    await page.reload();

    // Verify error message
    await expect(
      page.getByText(/something went wrong/i)
    ).toBeVisible();

    // Verify retry button
    const retryButton = page.getByRole('button', { name: /try again/i });
    await expect(retryButton).toBeVisible();
  });
});
